<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG getBBox() æ¸¬è©¦å·¥å…· - SVG BBox Inspector</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .svg-container {
            border: 2px dashed #e5e7eb;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .bbox-overlay {
            position: absolute;
            border: 2px solid #ef4444;
            background: rgba(239, 68, 68, 0.1);
            pointer-events: none;
        }
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.375rem;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.875rem;
            overflow-x: auto;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <h1 class="text-3xl font-bold text-gray-900">ğŸ“ SVG getBBox() æ¸¬è©¦å·¥å…·</h1>
            <p class="text-gray-600 mt-1">æ¸¬è©¦ SVG åœ–ç¤ºçš„å¯¦éš›é‚Šç•Œï¼Œç”¨æ–¼èª¿æ•´ sprite è¨­å®šå€¼</p>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- File Upload Section -->
        <div class="bg-white rounded-lg shadow-sm border p-6 mb-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">ğŸ“ ä¸Šå‚³ SVG æª”æ¡ˆ</h2>
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                <input type="file" id="file-input" accept=".svg" class="hidden">
                <div id="upload-area" class="cursor-pointer">
                    <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                    </svg>
                    <p class="text-gray-600">é»æ“Šé¸æ“‡ SVG æª”æ¡ˆæˆ–æ‹–æ”¾åˆ°æ­¤è™•</p>
                    <p class="text-sm text-gray-500 mt-1">æ”¯æ´ .svg æ ¼å¼</p>
                </div>
            </div>
        </div>

        <!-- SVG Display and Analysis -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- SVG Display -->
            <div class="bg-white rounded-lg shadow-sm border p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">ğŸ¨ SVG é è¦½</h2>
                <div id="svg-display-container" class="svg-container relative mb-4">
                    <p class="text-gray-500">è«‹ä¸Šå‚³ SVG æª”æ¡ˆ</p>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">é è¦½å¤§å°</label>
                        <select id="preview-size" class="w-full border border-gray-300 rounded-md px-3 py-2">
                            <option value="100">100px</option>
                            <option value="200" selected>200px</option>
                            <option value="300">300px</option>
                            <option value="400">400px</option>
                            <option value="500">500px</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">é¡¯ç¤ºé‚Šç•Œæ¡†</label>
                        <label class="inline-flex items-center">
                            <input type="checkbox" id="show-bbox" class="form-checkbox h-5 w-5 text-blue-600" checked>
                            <span class="ml-2 text-sm text-gray-700">é¡¯ç¤º BBox</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- BBox Information -->
            <div class="bg-white rounded-lg shadow-sm border p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">ğŸ“Š é‚Šç•Œè³‡è¨Š</h2>
                <div id="bbox-info" class="space-y-4">
                    <p class="text-gray-500">è«‹ä¸Šå‚³ SVG æª”æ¡ˆä»¥é¡¯ç¤ºé‚Šç•Œè³‡è¨Š</p>
                </div>
            </div>
        </div>

        <!-- Code Output -->
        <div class="bg-white rounded-lg shadow-sm border p-6 mt-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">ğŸ’» ç¨‹å¼ç¢¼è¼¸å‡º</h2>
            <div id="code-output">
                <p class="text-gray-500">ä¸Šå‚³ SVG æª”æ¡ˆå¾Œå°‡é¡¯ç¤ºç›¸é—œç¨‹å¼ç¢¼</p>
            </div>
        </div>

        <!-- Instructions -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mt-6">
            <h3 class="text-lg font-semibold text-blue-900 mb-3">ğŸ“– ä½¿ç”¨èªªæ˜</h3>
            <div class="text-blue-800 space-y-2">
                <p><strong>1. ä¸Šå‚³æª”æ¡ˆï¼š</strong>é¸æ“‡æˆ–æ‹–æ”¾ SVG æª”æ¡ˆåˆ°ä¸Šæ–¹å€åŸŸ</p>
                <p><strong>2. æª¢è¦–é‚Šç•Œï¼š</strong>ç³»çµ±æœƒè‡ªå‹•è¨ˆç®—ä¸¦é¡¯ç¤º SVG çš„å¯¦éš›é‚Šç•Œæ¡† (BBox)</p>
                <p><strong>3. èª¿æ•´è¨­å®šï¼š</strong>æ ¹æ“šé‚Šç•Œè³‡è¨Šèª¿æ•´ viewBox å’Œå…¶ä»– sprite è¨­å®š</p>
                <p><strong>4. è¤‡è£½ç¨‹å¼ç¢¼ï¼š</strong>ä½¿ç”¨ä¸‹æ–¹ç”¢ç”Ÿçš„ç¨‹å¼ç¢¼æ›´æ–°æ‚¨çš„ sprite è¨­å®š</p>
            </div>
        </div>
    </div>

    <script>
        let currentSVG = null;
        let bboxOverlay = null;

        // File input handling
        const fileInput = document.getElementById('file-input');
        const uploadArea = document.getElementById('upload-area');

        uploadArea.addEventListener('click', () => fileInput.click());

        // Drag and drop handling
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('border-blue-500', 'bg-blue-50');
        });

        uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('border-blue-500', 'bg-blue-50');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('border-blue-500', 'bg-blue-50');
            
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type === 'image/svg+xml') {
                handleFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        // Handle uploaded file
        function handleFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const svgContent = e.target.result;
                loadSVG(svgContent, file.name);
            };
            reader.readAsText(file);
        }

        // Load and display SVG
        function loadSVG(svgContent, filename) {
            const container = document.getElementById('svg-display-container');
            container.innerHTML = svgContent;
            
            currentSVG = container.querySelector('svg');
            if (currentSVG) {
                // Style the SVG for display
                const size = document.getElementById('preview-size').value;
                currentSVG.style.width = size + 'px';
                currentSVG.style.height = size + 'px';
                currentSVG.style.border = '1px solid #e5e7eb';
                
                // Wait for SVG to render then calculate bbox
                setTimeout(() => {
                    calculateBBox(filename, svgContent);
                }, 100);
            }
        }

        // Calculate bounding box
        function calculateBBox(filename, svgContent) {
            if (!currentSVG) return;

            try {
                // Get bbox of the entire SVG content
                const bbox = currentSVG.getBBox();
                
                // Get original viewBox if exists
                const originalViewBox = currentSVG.getAttribute('viewBox');
                const svgWidth = currentSVG.getAttribute('width') || currentSVG.style.width;
                const svgHeight = currentSVG.getAttribute('height') || currentSVG.style.height;

                displayBBoxInfo(bbox, originalViewBox, svgWidth, svgHeight, filename);
                showBBoxOverlay(bbox);
                generateCode(bbox, originalViewBox, filename, svgContent);

            } catch (error) {
                console.error('Error calculating bbox:', error);
                document.getElementById('bbox-info').innerHTML = `
                    <div class="text-red-600">
                        <p>âŒ ç„¡æ³•è¨ˆç®—é‚Šç•Œæ¡†</p>
                        <p class="text-sm mt-1">éŒ¯èª¤: ${error.message}</p>
                    </div>
                `;
            }
        }

        // Display bbox information
        function displayBBoxInfo(bbox, originalViewBox, svgWidth, svgHeight, filename) {
            const bboxInfo = document.getElementById('bbox-info');
            
            bboxInfo.innerHTML = `
                <div class="space-y-4">
                    <div>
                        <h4 class="font-medium text-gray-900 mb-2">æª”æ¡ˆè³‡è¨Š</h4>
                        <div class="bg-gray-50 p-3 rounded text-sm space-y-1">
                            <p><span class="font-medium">æª”æ¡ˆåç¨±:</span> ${filename}</p>
                            <p><span class="font-medium">åŸå§‹å°ºå¯¸:</span> ${svgWidth} Ã— ${svgHeight}</p>
                            <p><span class="font-medium">åŸå§‹ ViewBox:</span> ${originalViewBox || 'æœªè¨­å®š'}</p>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-medium text-gray-900 mb-2">å¯¦éš›é‚Šç•Œ (BBox)</h4>
                        <div class="bg-red-50 p-3 rounded text-sm space-y-1">
                            <p><span class="font-medium">X:</span> ${bbox.x.toFixed(2)}</p>
                            <p><span class="font-medium">Y:</span> ${bbox.y.toFixed(2)}</p>
                            <p><span class="font-medium">å¯¬åº¦:</span> ${bbox.width.toFixed(2)}</p>
                            <p><span class="font-medium">é«˜åº¦:</span> ${bbox.height.toFixed(2)}</p>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-medium text-gray-900 mb-2">å»ºè­°çš„ ViewBox</h4>
                        <div class="bg-green-50 p-3 rounded text-sm">
                            <p class="font-mono">${bbox.x.toFixed(2)} ${bbox.y.toFixed(2)} ${bbox.width.toFixed(2)} ${bbox.height.toFixed(2)}</p>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-medium text-gray-900 mb-2">é¢ç©è³‡è¨Š</h4>
                        <div class="bg-blue-50 p-3 rounded text-sm space-y-1">
                            <p><span class="font-medium">å¯¦éš›é¢ç©:</span> ${(bbox.width * bbox.height).toFixed(2)}</p>
                            <p><span class="font-medium">é•·å¯¬æ¯”:</span> ${(bbox.width / bbox.height).toFixed(3)}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Show bbox overlay
        function showBBoxOverlay(bbox) {
            if (!document.getElementById('show-bbox').checked) return;
            
            // Remove existing overlay
            if (bboxOverlay) {
                bboxOverlay.remove();
            }

            if (!currentSVG) return;

            // Calculate scale and position
            const svgRect = currentSVG.getBoundingClientRect();
            const containerRect = currentSVG.parentElement.getBoundingClientRect();
            
            // Get SVG's viewBox or use default
            const viewBox = currentSVG.viewBox.baseVal;
            const viewBoxWidth = viewBox.width || parseFloat(currentSVG.getAttribute('width')) || 100;
            const viewBoxHeight = viewBox.height || parseFloat(currentSVG.getAttribute('height')) || 100;
            
            // Calculate scale
            const scaleX = svgRect.width / viewBoxWidth;
            const scaleY = svgRect.height / viewBoxHeight;
            
            // Create overlay
            bboxOverlay = document.createElement('div');
            bboxOverlay.className = 'bbox-overlay';
            
            const overlayX = (bbox.x - viewBox.x) * scaleX;
            const overlayY = (bbox.y - viewBox.y) * scaleY;
            const overlayWidth = bbox.width * scaleX;
            const overlayHeight = bbox.height * scaleY;
            
            bboxOverlay.style.left = (svgRect.left - containerRect.left + overlayX) + 'px';
            bboxOverlay.style.top = (svgRect.top - containerRect.top + overlayY) + 'px';
            bboxOverlay.style.width = overlayWidth + 'px';
            bboxOverlay.style.height = overlayHeight + 'px';
            
            currentSVG.parentElement.appendChild(bboxOverlay);
        }

        // Generate code snippets
        function generateCode(bbox, originalViewBox, filename, svgContent) {
            const newViewBox = `${bbox.x.toFixed(2)} ${bbox.y.toFixed(2)} ${bbox.width.toFixed(2)} ${bbox.height.toFixed(2)}`;
            
            const codeOutput = document.getElementById('code-output');
            codeOutput.innerHTML = `
                <div class="space-y-4">
                    <div>
                        <h4 class="font-medium text-gray-900 mb-2">1. æ›´æ–° ViewBox å±¬æ€§</h4>
                        <div class="code-block">
&lt;svg viewBox="${newViewBox}"&gt;
  &lt;!-- SVG å…§å®¹ --&gt;
&lt;/svg&gt;
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-medium text-gray-900 mb-2">2. Symbol æ ¼å¼ (ç”¨æ–¼ Sprite)</h4>
                        <div class="code-block">
&lt;symbol id="your-icon-id" viewBox="${newViewBox}"&gt;
  &lt;!-- å°‡åŸå§‹ SVG å…§å®¹è²¼åœ¨é€™è£¡ --&gt;
&lt;/symbol&gt;
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-medium text-gray-900 mb-2">3. Manifest è¨­å®š</h4>
                        <div class="code-block">
{
  "id": "your-icon-id",
  "symbolId": "icon-your-id",
  "viewBox": "${newViewBox}",
  "bbox": {
    "x": ${bbox.x.toFixed(2)},
    "y": ${bbox.y.toFixed(2)},
    "width": ${bbox.width.toFixed(2)},
    "height": ${bbox.height.toFixed(2)}
  }
}
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-medium text-gray-900 mb-2">4. å„ªåŒ–å»ºè­°</h4>
                        <div class="bg-yellow-50 border border-yellow-200 p-4 rounded">
                            <ul class="text-sm text-yellow-800 space-y-1">
                                ${bbox.x !== 0 || bbox.y !== 0 ? 
                                    '<li>â€¢ åœ–ç¤ºæœ‰åç§»ï¼Œå»ºè­°èª¿æ•´åº§æ¨™ä½¿å…¶å¾ (0,0) é–‹å§‹</li>' : 
                                    '<li>â€¢ âœ“ åœ–ç¤ºåº§æ¨™æ­£ç¢ºï¼Œå¾ (0,0) é–‹å§‹</li>'
                                }
                                ${(bbox.width / bbox.height) === 1 ? 
                                    '<li>â€¢ âœ“ é•·å¯¬æ¯”ç‚º 1:1ï¼Œé©åˆä½œç‚ºåœ–ç¤º</li>' : 
                                    '<li>â€¢ é•·å¯¬æ¯”ä¸æ˜¯ 1:1ï¼Œå¯èƒ½éœ€è¦èª¿æ•´æˆ–è£åˆ‡</li>'
                                }
                                ${bbox.width > 1000 || bbox.height > 1000 ? 
                                    '<li>â€¢ åœ–ç¤ºå°ºå¯¸è¼ƒå¤§ï¼Œå»ºè­°å„ªåŒ–ä»¥æ¸›å°‘æª”æ¡ˆå¤§å°</li>' : 
                                    '<li>â€¢ âœ“ åœ–ç¤ºå°ºå¯¸é©ä¸­</li>'
                                }
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        // Event listeners
        document.getElementById('preview-size').addEventListener('change', () => {
            if (currentSVG) {
                const size = document.getElementById('preview-size').value;
                currentSVG.style.width = size + 'px';
                currentSVG.style.height = size + 'px';
                
                // Recalculate overlay
                setTimeout(() => {
                    if (currentSVG) {
                        const bbox = currentSVG.getBBox();
                        showBBoxOverlay(bbox);
                    }
                }, 100);
            }
        });

        document.getElementById('show-bbox').addEventListener('change', () => {
            if (bboxOverlay) {
                bboxOverlay.style.display = document.getElementById('show-bbox').checked ? 'block' : 'none';
            }
        });

        console.log('ğŸ“ BBox æ¸¬è©¦å·¥å…·è¼‰å…¥å®Œæˆï¼');
    </script>
</body>
</html>